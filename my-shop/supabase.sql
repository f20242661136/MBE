create table products (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  title text not null,
  price numeric not null,
  image_urls text[] not null default '{}',
  description text,
  category text,
  rating numeric default 4.5,
  review_count integer default 0,
  stock_quantity integer default 10,
  specifications jsonb default '{}',
  is_active boolean default true
);

create table orders (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  customer_name text not null,
  phone text not null,
  city text not null,
  address text not null,
  product_id bigint references products(id),
  product_title text,
  product_price numeric,
  quantity integer default 1,
  total_amount numeric,
  status text default 'Pending' -- Pending, Confirmed, Shipped, Delivered, Returned
);

create table reviews (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  product_id bigint references products(id) not null,
  customer_name text not null,
  rating integer not null check (rating >= 1 and rating <= 5),
  comment text,
  verified_purchase boolean default false
);
insert into storage.buckets (id, name, public)
select 'images', 'images', true
where not exists (
  select 1 from storage.buckets where id = 'images'
);
alter table products enable row level security;
alter table orders enable row level security;
alter table reviews enable row level security;
create policy "Public View Products"
on products for select
using (true);
create policy "Admin Manage Products"
on products for all
using (auth.role() = 'authenticated')
with check (auth.role() = 'authenticated');
create policy "Public Create Orders"
on orders for insert
with check (true);
create policy "Admin View Orders"
on orders for select
using (auth.role() = 'authenticated');
create policy "Admin Update Orders"
on orders for update
using (auth.role() = 'authenticated')
with check (auth.role() = 'authenticated');
create policy "Public View Images"
on storage.objects
for select
using (bucket_id = 'images');
create policy "Admin Upload Images"
on storage.objects
for insert
with check (bucket_id = 'images' and auth.role() = 'authenticated');
create policy "Admin Delete Images"
on storage.objects
for delete
using (auth.role() = 'authenticated');

create policy "Public View Reviews"
on reviews for select
using (true);
create policy "Public Create Reviews"
on reviews for insert
with check (true);

-- Insert sample products
INSERT INTO products (title, price, image_urls, description, category, rating, review_count, stock_quantity, specifications) VALUES
('iPhone 15 Pro Max', 450000, ARRAY['https://images.unsplash.com/photo-1592899677977-9c10ca588bbd?w=400', 'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=400', 'https://images.unsplash.com/photo-1565849904461-04a58ad377e0?w=400'], 'Latest iPhone with advanced camera system and A17 Pro chip', 'Smartphones', 4.8, 1250, 15, '{"Storage": "256GB", "Color": "Natural Titanium", "Display": "6.7-inch Super Retina XDR"}'),
('Samsung Galaxy S24 Ultra', 380000, ARRAY['https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=400', 'https://images.unsplash.com/photo-1605236453806-6ff36851218e?w=400'], 'Premium Android smartphone with S Pen and 200MP camera', 'Smartphones', 4.7, 980, 20, '{"Storage": "512GB", "Color": "Titanium Black", "Display": "6.8-inch Dynamic AMOLED 2X"}'),
('MacBook Pro 16-inch', 650000, ARRAY['https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=400', 'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=400'], 'Powerful laptop for professionals with M3 Max chip', 'Laptops', 4.9, 756, 8, '{"Processor": "Apple M3 Max", "RAM": "32GB", "Storage": "1TB SSD"}'),
('Dell XPS 13', 285000, ARRAY['https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=400', 'https://images.unsplash.com/photo-1587614295999-6c1a3262bc88?w=400'], 'Ultra-portable laptop with stunning display', 'Laptops', 4.6, 542, 12, '{"Processor": "Intel Core i7", "RAM": "16GB", "Storage": "512GB SSD"}'),
('Sony WH-1000XM5', 85000, ARRAY['https://images.unsplash.com/photo-1583394838336-acd977736f90?w=400', 'https://images.unsplash.com/photo-1484704849700-f032a568e944?w=400'], 'Industry-leading noise canceling wireless headphones', 'Headphones', 4.8, 2100, 25, '{"Battery Life": "30 hours", "ANC": "Yes", "Connectivity": "Bluetooth 5.2"}'),
('AirPods Pro (2nd Gen)', 55000, ARRAY['https://images.unsplash.com/photo-1606220945770-b5b6c2c9bf1d?w=400', 'https://images.unsplash.com/photo-1572569511254-d8f925fe2cbb?w=400'], 'Wireless earbuds with active noise cancellation', 'Headphones', 4.7, 3200, 30, '{"Battery Life": "6 hours", "ANC": "Yes", "Water Resistant": "IPX4"}'),
('iPad Pro 12.9-inch', 320000, ARRAY['https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400', 'https://images.unsplash.com/photo-1544244615-868d2efc5887?w=400'], 'Powerful tablet for creators and professionals', 'Tablets', 4.8, 890, 10, '{"Display": "12.9-inch Liquid Retina XDR", "Chip": "M2", "Storage": "256GB"}'),
('Samsung Galaxy Tab S9', 180000, ARRAY['https://images.unsplash.com/photo-1586953208448-b95a79798f07?w=400', 'https://images.unsplash.com/photo-1544244592-c48f8fac471c?w=400'], 'Premium Android tablet with S Pen included', 'Tablets', 4.5, 445, 18, '{"Display": "11-inch Dynamic AMOLED 2X", "Chip": "Snapdragon 8 Gen 2", "Storage": "128GB"}'),
('Nintendo Switch OLED', 95000, ARRAY['https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400', 'https://images.unsplash.com/photo-1605902711834-8b11c3e3ef2f?w=400'], 'Handheld gaming console with vibrant OLED display', 'Gaming', 4.6, 1200, 22, '{"Display": "7-inch OLED", "Storage": "64GB", "Battery Life": "9 hours"}'),
('PlayStation 5', 185000, ARRAY['https://images.unsplash.com/photo-1606813907291-d86efa9b94db?w=400', 'https://images.unsplash.com/photo-1605901309584-818e25960a8f?w=400'], 'Next-generation gaming console with 4K graphics', 'Gaming', 4.9, 3400, 5, '{"Storage": "825GB SSD", "Resolution": "4K", "HDR": "Yes"}'),
('Apple Watch Series 9', 125000, ARRAY['https://images.unsplash.com/photo-1551816230-ef5deaed4a26?w=400', 'https://images.unsplash.com/photo-1434494878577-86c23bcb06b9?w=400'], 'Advanced smartwatch with health and fitness features', 'Wearables', 4.7, 1650, 16, '{"Display": "45mm Retina", "Health": "ECG, Blood Oxygen", "Battery": "18 hours"}'),
('Samsung Galaxy Watch 6', 75000, ARRAY['https://images.unsplash.com/photo-1434494878577-86c23bcb06b9?w=400', 'https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=400'], 'Feature-rich smartwatch with comprehensive health tracking', 'Wearables', 4.4, 890, 20, '{"Display": "40mm Super AMOLED", "Health": "ECG, Blood Pressure", "Battery": "40 hours"}');

-- Insert sample reviews
INSERT INTO reviews (product_id, customer_name, rating, comment, verified_purchase) VALUES
(1, 'Ahmed Khan', 5, 'Amazing camera quality and battery life. Worth every penny!', true),
(1, 'Sara Ahmed', 4, 'Great phone but expensive. Camera is outstanding though.', true),
(1, 'Muhammad Ali', 5, 'Best iPhone yet. The titanium build is premium.', true),
(2, 'Fatima Bibi', 5, 'S Pen is a game changer. Love the camera capabilities.', true),
(2, 'Omar Farooq', 4, 'Excellent Android phone with great features.', true),
(3, 'Zainab Malik', 5, 'Perfect for video editing. M3 chip is incredibly fast.', true),
(3, 'Hassan Raza', 5, 'Best laptop I have ever owned. Battery life is amazing.', true),
(4, 'Ayesha Khan', 4, 'Lightweight and powerful. Great for students.', true),
(5, 'Bilal Ahmed', 5, 'Noise cancellation is incredible. Perfect for work.', true),
(6, 'Maryam Ali', 4, 'Good sound quality but battery drains quickly.', true);
